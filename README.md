SELECT
  PROVIDER_IDENTIFICATION_NBR,
  NETWORK_ID,
  SERVICE_LOCATION_NBR,

  -- PBG numbers (group nbr)
  ARRAY_AGG(PROVIDER_BUSINESS_GROUP_NBR IGNORE NULLS
            ORDER BY PROVIDER_BUSINESS_GROUP_NBR) AS pbg_all,
  COUNTIF(PROVIDER_BUSINESS_GROUP_NBR IS NOT NULL) AS pbg_all_len,
  ARRAY_AGG(DISTINCT PROVIDER_BUSINESS_GROUP_NBR IGNORE NULLS
            ORDER BY PROVIDER_BUSINESS_GROUP_NBR) AS pbg_unique,
  COUNT(DISTINCT PROVIDER_BUSINESS_GROUP_NBR) AS pbg_unique_len,

  -- PBG score numbers
  ARRAY_AGG(PROVIDER_BUSINESS_GROUP_SCORE_NBR IGNORE NULLS
            ORDER BY PROVIDER_BUSINESS_GROUP_SCORE_NBR) AS pbgs_all,
  COUNTIF(PROVIDER_BUSINESS_GROUP_SCORE_NBR IS NOT NULL) AS pbgs_all_len,
  ARRAY_AGG(DISTINCT PROVIDER_BUSINESS_GROUP_SCORE_NBR IGNORE NULLS
            ORDER BY PROVIDER_BUSINESS_GROUP_SCORE_NBR) AS pbgs_unique,
  COUNT(DISTINCT PROVIDER_BUSINESS_GROUP_SCORE_NBR) AS pbgs_unique_len
FROM `anbc-hcb-dev.prv_ps_ce_dec_hcb_dev.CET_PROVIDERS`
GROUP BY 1,2,3
-- Keep only groups with no duplicates (optional):
-- HAVING COUNTIF(PROVIDER_BUSINESS_GROUP_NBR IS NOT NULL)
--        = COUNT(DISTINCT PROVIDER_BUSINESS_GROUP_NBR)
;
