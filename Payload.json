def _add_optional_rate_params(self, query, params):
    # Split the query on GROUP BY
    query_split_by_group_by = query.split("GROUP BY")
    query = query_split_by_group_by[0].rstrip() + " "

    if "providerspecialtycode" in params:
        query += """
        AND SPECIALTY_CD = (
            SELECT CASE 
                     WHEN EXISTS (
                       SELECT 1 
                       FROM CET_RATES 
                       WHERE SPECIALTY_CD = @providerspecialtycode
                     )
                     THEN @providerspecialtycode
                     ELSE ''
                   END
        )
        """

    elif "providertype" in params:
        query += """
        AND SPECIALTY_CD = (
            SELECT CASE 
                     WHEN EXISTS (
                       SELECT 1 
                       FROM CET_RATES 
                       WHERE SPECIALTY_CD = @providertype
                     )
                     THEN @providertype
                     ELSE ''
                   END
        )
        """

    # Add back GROUP BY clause
    query += "\nGROUP BY " + query_split_by_group_by[1]
    return query
